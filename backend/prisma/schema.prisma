// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  MODERATOR
  USER
}

enum AdminLogType {
  UPDATE
  CREATE
  DELETE
  GENERAL
}

model Account {
  id                String  @id @default(cuid())
  username          String  @db.Citext @unique
  email             String  @db.Citext @unique
  password          String
  verificationCode  String?
  passwordResetCode String?
  refreshToken      String  @default("")
  verified          Boolean @default(false)
  role              Role    @default(USER)

  verifiedAt      DateTime?
  passwordResetAt DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  profile Profile?
  adminLogs AdminLog[]

  @@index([role])
}

model Profile {
  id  String @id @default(cuid())
  account Account @relation(fields: [accountId], references: [id])
  accountId String @unique
  firstName String?
  lastName String?
  birthDate DateTime?
  country String?
  city String?
  organization String?
  lastVisit DateTime?
  registered DateTime @default(now())

  imagePath String @default("default")

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt @default(now())

  following    Follows[] @relation("Following")
  followers    Follows[] @relation("Followers")

  @@index([country])
  @@index([organization])
  @@index([city])
}

model Follows {
  id          String   @id @default(cuid())
  follower    Profile  @relation("Followers", fields: [followerId], references: [id])
  followerId  String
  following   Profile  @relation("Following", fields: [followingId], references: [id])
  followingId String

  createdAt   DateTime @default(now())

  @@unique([followerId, followingId])
}

model AdminLog {
  id String @id @default(cuid())

  author Account @relation(fields: [authorId], references: [id])
  authorId String

  text String
  type AdminLogType

  createdAt       DateTime  @default(now())
}
